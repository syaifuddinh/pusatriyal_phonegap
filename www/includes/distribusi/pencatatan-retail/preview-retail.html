<div class="subcontent" style="">
<style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
    }

    .title-edit
    {
        margin-top: 60px;
        margin-left: 20px;
        margin-bottom: 30px;
        width: 70%;
        border: none;
        color: #14c56d;
    }

    .btnSubmit
    {
        border-radius: 50mm;
        margin-top: 8mm;
        margin-bottom: 50px;
        padding: 3mm 10mm;
        border: none;
        cursor: pointer;
        background: #42ec98;
        color: #FFFFFF;
        font-weight: bold;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .border-bottom-1 {
        border-bottom: 2px solid #42ec98 !important;
    }
    .label-for
    {
      font-weight: bold;
      color: #646464ff;
      margin-bottom: 0px;
    }
    .listx
    {
      font-weight: bold;
    }

    .card-body {
      border-bottom:1px solid #e7e7e7;
    }/*
    .card {
      margin-left: 4mm;
      margin-right: 4mm;
      margin-bottom: 10mm;
    }
    */
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
    }
    #login .container #login-row #login-column #login-box {
      margin-top: 60px;
      max-width: 600px;
      height: 320px;
    }
    #login .container #login-row #login-column #login-box #login-form {
      padding: 26px;
      margin-bottom: 35mm;
    }
    #login .container #login-row #login-column #login-box #login-form #register-link {
      margin-top: -85px;
    }


    .btnSubmit
    {
        border-radius: 50mm;
        margin-top: 8mm;
        margin-bottom: 50px;
        padding: 3mm 10mm;
        border: none;
        cursor: pointer;
        background: #42ec98;
        color: #FFFFFF;
        font-weight: bold;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .border-bottom-1 {
        border-bottom: 2px solid #42ec98 !important;
    }
    .label-for
    {
      font-weight: bold;
      color: #646464ff;
      margin-bottom: 0px;
    }
    form {
      padding-left: 5mm;
      padding-right: 5mm;
    }
</style>

<div class="pusatriyal-submit btn-group">
  		<button type="button" class="btn btn-success" id="antar" pusatriyal-target="includes/distribusi/pencatatan-retail/preview-tracking.html" pusatriyal-role="routing" onclick="antar()">Antar</button>
</div>
<div class="breadcrumb-pusatriyal">
  <span class="active">Preview Retail</span>
</div>
<form id="opname-form" class="form" action="" method="post" autocomplete="off" style="margin-bottom: 25mm">
<input type="hidden" name="_token" id="_token">
<input type="hidden" name="sr_id" id="sr_id">
    <div class="w-100 text-center mb-3">
      <h3>Nota</h3>
      <h5 id="nota">
          ?
      </h5>
    </div>
    <div class="form-group">
        <label class="label-for" for="cabang" >Cabang</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="cabang" id="cabang" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label class="label-for" for="tanggal" >Tanggal</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="tanggal" id="tanggal" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label for="keterangan" class="label-for">Keterangan</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="keterangan" id="keterangan" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label for="customer" class="label-for">Customer</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="customer" id="customer" class="form-control-plaintext" >
        </div>

    </div>
    <div class="form-group">
        <label for="marketing" class="label-for">Marketing</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="marketing" id="marketing" class="form-control-plaintext" >
        </div>

    </div>
    <div class="form-group">
        <label for="pengirim" class="label-for">Petugas pengirim</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="pengirim" id="pengirim" class="form-control-plaintext" >
        </div>

    </div>
    <div class="form-group">
        <label for="netto" class="label-for">Netto</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="netto" id="netto" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label for="netto" class="label-for">Metode pembayaran</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="metodepembayaran" id="metodepembayaran" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label for="netto" class="label-for">Status pembayaran</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="statuspembayaran" id="statuspembayaran" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group" id="divbank" style="display:none;">
        <label for="netto" class="label-for">Bank</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="bank" id="bank" class="form-control-plaintext" >
        </div>
    </div>
    <div id="divtransfer" style="display:none">
    <div class="form-group">
        <label for="netto" class="label-for">Atas nama</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="atasnama" id="atasnama" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label for="netto" class="label-for">No rekening</label><br>
        <div class="border-bottom border-bottom-1">
          <input type="text" readonly="" name="norekening" id="norekening" class="form-control-plaintext" >
        </div>
    </div>
    <div class="form-group">
        <label for="netto" class="label-for">Bukti transfer</label><br>
        <div class="border-bottom border-bottom-1">
          <img src="" id="buktitransfer" class="img-responsive" style="max-width: 120mm">
        </div>
    </div>
    </div>
    <div id="list-item">

    </div>
    <center><p id="status"></p></center>
    </div>

</form>

    <script type="text/javascript" src="includes/stock/opname_stock/js/preview-opname-commander.js"></script>
  <script type="text/javascript">
  $(document).ready(function(){
    var html = "";
    $.ajax({
      type: 'get',
      data: {id:$('#sr_id').val(), user_comp:localStorage.getItem('m_comp_id')},
      dataType: 'JSON',
      url: url('api/riyal/distribusi/retail/penjualan/detailapi'),
      success : function(response){        ;
        $('#marketing').val(response.penjualan.marketing_name);
        if(response.penjualan.officer_name == null || response.penjualan.officer_name == ""){
          $('#pengirim').val('Tidak Ada Petugas');
        }
        else {
          $('#pengirim').val(response.penjualan.officer_name);
        }

        $('#metodepembayaran').val(response.penjualan.sr_metode_transfer);
        if (response.penjualan.sr_status_pembayaran == 0) {
          $('#statuspembayaran').val('Belum Terbayar');
        } else {
          $('#statuspembayaran').val('Sudah Terbayar');
        }

        if (response.penjualan.sr_metode_transfer == 'TRANSFER') {
          $('#bank').val(response.penjualan.sr_bank);
          $('#divbank').css('display', '');
        } else {
          $('#divbank').css('display', 'none');
        }

        if (response.penjualan.sr_metode_transfer == 'TRANSFER') {
          $('#divtransfer').css('display', '');
          $('#atasnama').val(response.penjualan.sr_atas_nama);
          $('#norekening').val(response.penjualan.sr_rekening);
          $('#buktitransfer').attr('src', url('storage') + '/' + response.penjualan.sr_bukti_transfer);
        }
        console.log(response);
        for (var i = 0; i < response.penjualan_dt.length; i++) {

          valueqty = parseFloat(response.penjualan_dt[i].srdt_qty) * parseFloat(response.penjualan_dt[i].ir_nilaitoreal);

          html += '<div class="accordion">'+
            '<div class="card">'+
              '<div class="card-header bg-success header-collapse p-0" id="headingOne">'+
                '<h5 class="mb-0">'+
                  '<button class="btn btn-link btn-block btn-header text-white" type="button" data-toggle="collapse" data-target="#collapse'+i+'" aria-expanded="true" aria-controls="collapseOne">'+
                    response.penjualan_dt[i].ir_name+
                  '</button>'+
                '</h5>'+
              '</div>'+
              ''+
              '<div id="collapse'+i+'" class="collapse datalist-collapse" aria-labelledby="headingOne" data-parent="#list-item">'+
                '<div class="card">'+
                  '<div class="card-body card-forlist p-3">'+
                    ''+
                    '<span>'+
                      '<small class="font-weight-bold">Stock</small> <small id="stock">'+response.penjualan_dt[i].sr_qty+'</small>'+
                    '</span>'+
                    '<br>'+
                    '<span>'+
                      '<small class="font-weight-bold">Qty</small> <small id="qty">'+response.penjualan_dt[i].srdt_qty+'</small>'+
                    '</span>'+
                    '<br>'+
                    '<span>'+
                      '<small class="font-weight-bold">Value Qty</small> <small id="valueqty">'+response.penjualan_dt[i].srdt_valueqty+'</small>'+
                    '</span>'+
                    '<br>'+
                    '<span>'+
                      '<small class="font-weight-bold">Price</small> <small id="price">'+get_currency(response.penjualan_dt[i].srdt_price)+'</small>'+
                    '</span>'+
                  '</div>'+
                  '<div class="card-footer">'+
                    '<span>'+
                      '<span class="font-weight-bold">Total</span> <span id="status">'+get_currency(response.penjualan_dt[i].srdt_total)+'</span>'+
                    '</span>'+
                  '</div>'+
                  ''+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>';
        }
        console.log(html);
        $('#list-item').html(html);
      }
    });
  });

  function setujui() {
		iziToast.show({
			theme: 'dark',
			icon: 'icon-person',
			message: 'Apakah Anda yakin untuk meng-approve data ini ?',
			progressBarColor: 'rgb(0, 255, 184)',
			buttons: [
			['<button>IYA </button>', function (instance, toast) {
        var idtransaksi = $('#sr_id').val();
        console.log(idtransaksi);
				$.ajax({
					data : {idtransaksi},
					type : "get",
					url : url('api/riyal/distribusi/retail/penjualan/selesai'),
					dataType : 'json',
					success : function (response){
						iziToast.destroy();
						if(response.status == 'sukses'){
							iziToast.info({
								message: 'Data Berhasil disimpan!',
								position : 'topRight'
							});
							$('#setujui').attr('disabled' , true);
							$('#tolak').attr('disabled' , true);
              Routing.load_page('includes/distribusi/penjualan-retail/transaksi-pemesanan.html');
						}
						else {
							iziToast.error({
								message: 'Terjadi kesalahan!',
								position : 'topRight'
							});

						}
					},
					error : function(){
						iziToast.warning({
							title: 'ERROR',
							message: 'ERROR hubungi Developer',
						});
					}
				})
			}, true], // true to focus
			['<button> TIDAK </button>', function (instance, toast) {
				instance.hide({
					transitionOut: 'fadeOutUp',
					onClosing: function(instance, toast, closedBy){
						console.info('closedBy: ' + closedBy); // The return will be: 'closedBy: buttonName'
					}
					}, toast, 'buttonName');
					}]
					],
					onOpening: function(instance, toast){
						console.info('callback abriu!');
					},
					onClosing: function(instance, toast, closedBy){
					console.info('closedBy: ' + closedBy); // tells if it was closed by 'drag' or 'button'
					}
		});
	}

	function tolak() {
		iziToast.show({
			theme: 'dark',
			icon: 'icon-person',
			message: 'Apakah Anda yakin untuk meng-approve data ini ?',
			progressBarColor: 'rgb(0, 255, 184)',
			buttons: [
			['<button>IYA </button>', function (instance, toast) {
				$.ajax({
					data : {idtransaksi:$('#sr_id').val()},
					type : "get",
					url : url('api/riyal/distribusi/retail/penjualan/ditolak'),
					dataType : 'json',
					success : function (response){
						iziToast.destroy();
						if(response.status == 'sukses'){
							iziToast.info({
								message: 'Data Berhasil disimpan!',
								position : 'topRight'
							});
							$('#setujui').attr('disabled' , true);
							$('#tolak').attr('disabled' , true);
              Routing.load_page('includes/distribusi/penjualan-retail/transaksi-pemesanan.html');
						}
						else {
							iziToast.error({
								message: 'Terjadi kesalahan!',
								position : 'topRight'
							});

						}
					},
					error : function(){
						iziToast.warning({
							title: 'ERROR',
							message: 'ERROR hubungi Developer',
						});
					}
				})
			}, true], // true to focus
			['<button> TIDAK </button>', function (instance, toast) {
				instance.hide({
					transitionOut: 'fadeOutUp',
					onClosing: function(instance, toast, closedBy){
						console.info('closedBy: ' + closedBy); // The return will be: 'closedBy: buttonName'
					}
					}, toast, 'buttonName');
					}]
					],
					onOpening: function(instance, toast){
						console.info('callback abriu!');
					},
					onClosing: function(instance, toast, closedBy){
					console.info('closedBy: ' + closedBy); // tells if it was closed by 'drag' or 'button'
					}
		});
	}

    function antar(){
      sr_id = $('#sr_id').val();
      start(sr_id);
    }

  </script>
</div>
